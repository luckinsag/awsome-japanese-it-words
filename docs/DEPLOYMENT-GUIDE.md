# ITWORDS éƒ¨ç½²è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‹ è„šæœ¬æ¦‚è§ˆ

æœ¬é¡¹ç›®æä¾›äº†å¤šç§éƒ¨ç½²è„šæœ¬ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ï¼š

| è„šæœ¬ | ç”¨é€” | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|------|----------|--------|
| `check-deployment.sh` | éƒ¨ç½²å‰æ£€æŸ¥ | éªŒè¯ç¯å¢ƒ | â­â­â­â­â­ |
| `quick-deploy-optimized.sh` | ä¼˜åŒ–å¿«é€Ÿéƒ¨ç½² | é¦–æ¬¡éƒ¨ç½² | â­â­â­â­â­ |
| `deploy-to-ec2-optimized.sh` | å®Œæ•´ä¼˜åŒ–éƒ¨ç½² | ç”Ÿäº§éƒ¨ç½² | â­â­â­â­â­ |
| `update-deployment.sh` | å¿«é€Ÿæ›´æ–° | å¢é‡æ›´æ–° | â­â­â­â­â­ |
| `quick-deploy.sh` | åŸå§‹å¿«é€Ÿéƒ¨ç½² | å¼€å‘æµ‹è¯• | â­â­â­ |
| `deploy-to-ec2.sh` | åŸå§‹å®Œæ•´éƒ¨ç½² | å¼€å‘æµ‹è¯• | â­â­â­ |

## ğŸš€ æ¨èéƒ¨ç½²æµç¨‹

### 1. é¦–æ¬¡éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. æ£€æŸ¥ç¯å¢ƒ
./check-deployment.sh

# 2. æ‰§è¡Œä¼˜åŒ–éƒ¨ç½²
./quick-deploy-optimized.sh
```

### 2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. æ£€æŸ¥ç¯å¢ƒ
./check-deployment.sh

# 2. æ‰§è¡Œå®Œæ•´ä¼˜åŒ–éƒ¨ç½²
./deploy-to-ec2-optimized.sh
```

### 3. å¿«é€Ÿæ›´æ–°

```bash
# æ‰§è¡Œå¿«é€Ÿæ›´æ–°
./update-deployment.sh
```

## ğŸ“ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### ç¯å¢ƒæ£€æŸ¥è„šæœ¬

**ç”¨é€”**: éªŒè¯æ‰€æœ‰éƒ¨ç½²å‰ç½®æ¡ä»¶

```bash
./check-deployment.sh
```

**æ£€æŸ¥é¡¹ç›®**:
- âœ… å¯†é’¥æ–‡ä»¶å­˜åœ¨æ€§å’Œæƒé™
- âœ… é¡¹ç›®ç›®å½•å®Œæ•´æ€§
- âœ… Dockeré…ç½®æ–‡ä»¶
- âœ… æ•°æ®æ–‡ä»¶
- âœ… éƒ¨ç½²è„šæœ¬
- âœ… EC2è¿æ¥
- âœ… AWS CLIé…ç½®
- âœ… EC2å®ä¾‹çŠ¶æ€
- âœ… æœ¬åœ°Dockerç¯å¢ƒ
- âœ… ç½‘ç»œè¿æ¥

### ä¼˜åŒ–å¿«é€Ÿéƒ¨ç½²è„šæœ¬

**ç”¨é€”**: ä¸€é”®å®Œæˆä¼˜åŒ–éƒ¨ç½²

```bash
./quick-deploy-optimized.sh
```

**ç‰¹ç‚¹**:
- ğŸš€ æœ¬åœ°æ„å»ºé•œåƒ
- ğŸ“¦ é•œåƒæ–‡ä»¶ä¼ è¾“
- âš¡ å¿«é€Ÿéƒ¨ç½²
- ğŸ›¡ï¸ é«˜ç¨³å®šæ€§

### å®Œæ•´ä¼˜åŒ–éƒ¨ç½²è„šæœ¬

**ç”¨é€”**: å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
./deploy-to-ec2-optimized.sh
```

**ç‰¹ç‚¹**:
- ğŸ”§ å®Œæ•´çš„Dockerç¯å¢ƒå®‰è£…
- ğŸ“¦ é•œåƒæ„å»ºå’Œä¼ è¾“
- ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–
- ğŸ”’ é˜²ç«å¢™é…ç½®
- ğŸ“Š è¯¦ç»†çš„çŠ¶æ€æ£€æŸ¥

### å¿«é€Ÿæ›´æ–°è„šæœ¬

**ç”¨é€”**: å¢é‡æ›´æ–°åº”ç”¨

```bash
./update-deployment.sh
```

**ç‰¹ç‚¹**:
- ğŸ’¾ è‡ªåŠ¨å¤‡ä»½å½“å‰éƒ¨ç½²
- ğŸ”„ åªæ›´æ–°å˜æ›´çš„é•œåƒ
- âš¡ å¿«é€Ÿé‡å¯
- ğŸ” çŠ¶æ€éªŒè¯

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### å¼€å‘ç¯å¢ƒ
```bash
# å¿«é€Ÿéƒ¨ç½²ç”¨äºå¼€å‘æµ‹è¯•
./quick-deploy.sh
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
./deploy-to-ec2-optimized.sh
```

### æ—¥å¸¸æ›´æ–°
```bash
# å¿«é€Ÿæ›´æ–°åº”ç”¨
./update-deployment.sh
```

### æ•…éšœæ’æŸ¥
```bash
# æ£€æŸ¥ç¯å¢ƒçŠ¶æ€
./check-deployment.sh
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰éƒ¨ç½²

1. **ä¿®æ”¹é…ç½®**
   ```bash
   # ç¼–è¾‘è„šæœ¬ä¸­çš„é…ç½®
   vim deploy-to-ec2-optimized.sh
   
   # ä¿®æ”¹EC2 IPåœ°å€
   EC2_IP="your-ec2-ip"
   ```

2. **è‡ªå®šä¹‰é•œåƒæ ‡ç­¾**
   ```bash
   # ä¿®æ”¹é•œåƒæ ‡ç­¾
   BACKEND_IMAGE="your-backend:latest"
   FRONTEND_IMAGE="your-frontend:latest"
   ```

3. **æ·»åŠ ç¯å¢ƒå˜é‡**
   ```bash
   # åœ¨è„šæœ¬ä¸­æ·»åŠ ç¯å¢ƒå˜é‡
   export CUSTOM_VAR="value"
   ```

### æ‰¹é‡éƒ¨ç½²

```bash
# åˆ›å»ºæ‰¹é‡éƒ¨ç½²è„šæœ¬
cat > batch-deploy.sh << 'EOF'
#!/bin/bash
# æ‰¹é‡éƒ¨ç½²åˆ°å¤šä¸ªEC2å®ä¾‹

INSTANCES=(
    "57.180.30.179"
    "your-other-ec2-ip"
)

for IP in "${INSTANCES[@]}"; do
    echo "éƒ¨ç½²åˆ° $IP"
    EC2_IP=$IP ./deploy-to-ec2-optimized.sh
done
EOF

chmod +x batch-deploy.sh
```

### è‡ªåŠ¨åŒ–éƒ¨ç½²

```bash
# åˆ›å»ºCI/CDè„šæœ¬
cat > ci-deploy.sh << 'EOF'
#!/bin/bash
# CI/CDè‡ªåŠ¨åŒ–éƒ¨ç½²

# æ£€æŸ¥ä»£ç å˜æ›´
if git diff --quiet HEAD~1 HEAD; then
    echo "æ²¡æœ‰ä»£ç å˜æ›´ï¼Œè·³è¿‡éƒ¨ç½²"
    exit 0
fi

# æ‰§è¡Œéƒ¨ç½²
./update-deployment.sh

# å‘é€é€šçŸ¥
curl -X POST "your-webhook-url" \
     -H "Content-Type: application/json" \
     -d '{"text":"éƒ¨ç½²å®Œæˆ"}'
EOF
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯†é’¥æ–‡ä»¶æƒé™é”™è¯¯**
   ```bash
   chmod 400 sag-.pem
   ```

2. **EC2è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥å®ä¾‹çŠ¶æ€
   aws ec2 describe-instances --instance-ids i-04319d3d7e427a629
   
   # æ£€æŸ¥å®‰å…¨ç»„
   aws ec2 describe-security-groups --group-ids [å®‰å…¨ç»„ID]
   ```

3. **Dockeræ„å»ºå¤±è´¥**
   ```bash
   # æ¸…ç†Dockerç¼“å­˜
   docker system prune -a
   
   # é‡æ–°æ„å»º
   docker-compose build --no-cache
   ```

4. **é•œåƒä¼ è¾“è¶…æ—¶**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   ping 57.180.30.179
   
   # ä½¿ç”¨rsyncæ›¿ä»£scp
   rsync -avz -e "ssh -i sag-.pem" deploy-images.tar.gz ec2-user@57.180.30.179:~/itwords-images/
   ```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
./deploy-to-ec2-optimized.sh 2>&1 | tee deploy.log

# æŸ¥çœ‹EC2ä¸Šçš„å®¹å™¨æ—¥å¿—
ssh -i sag-.pem ec2-user@57.180.30.179 "cd ~/itwords-images && docker-compose -f deploy-compose.yml logs -f"
```

### å›æ»šæ“ä½œ

```bash
# SSHåˆ°EC2
ssh -i sag-.pem ec2-user@57.180.30.179

# æŸ¥çœ‹å¤‡ä»½
cd ~/itwords-images
ls -la backup_*.sql

# å›æ»šæ•°æ®åº“
docker exec -i itwords-mysql mysql -u root -proot itwords_db < backup_20241219_143022.sql

# é‡å¯æœåŠ¡
docker-compose -f deploy-compose.yml restart
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### éƒ¨ç½²æ€§èƒ½æŒ‡æ ‡

```bash
# è®°å½•éƒ¨ç½²æ—¶é—´
time ./deploy-to-ec2-optimized.sh

# ç›‘æ§èµ„æºä½¿ç”¨
ssh -i sag-.pem ec2-user@57.180.30.179 "docker stats --no-stream"
```

### åº”ç”¨æ€§èƒ½ç›‘æ§

```bash
# æ£€æŸ¥APIå“åº”æ—¶é—´
curl -w "@curl-format.txt" -o /dev/null -s http://57.180.30.179:8080/api/health

# ç›‘æ§å®¹å™¨çŠ¶æ€
ssh -i sag-.pem ec2-user@57.180.30.179 "watch -n 1 'docker-compose -f deploy-compose.yml ps'"
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **å¯†é’¥ç®¡ç†**
   - å®šæœŸè½®æ¢EC2å¯†é’¥å¯¹
   - ä½¿ç”¨SSHå¯†é’¥è€Œä¸æ˜¯å¯†ç 
   - é™åˆ¶å¯†é’¥æ–‡ä»¶æƒé™

2. **ç½‘ç»œå®‰å…¨**
   - é…ç½®å®‰å…¨ç»„è§„åˆ™
   - ä½¿ç”¨VPCå’Œç§æœ‰å­ç½‘
   - å¯ç”¨WAFå’ŒDDoSé˜²æŠ¤

3. **åº”ç”¨å®‰å…¨**
   - å®šæœŸæ›´æ–°Dockeré•œåƒ
   - ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
   - å¯ç”¨HTTPS

4. **ç›‘æ§å‘Šè­¦**
   - é…ç½®CloudWatchç›‘æ§
   - è®¾ç½®å¼‚å¸¸å‘Šè­¦
   - å®šæœŸæ£€æŸ¥æ—¥å¿—

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: æ£€æŸ¥è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
2. **éªŒè¯ç¯å¢ƒ**: è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬
3. **æµ‹è¯•è¿æ¥**: ç¡®è®¤ç½‘ç»œå’ŒSSHè¿æ¥
4. **æ£€æŸ¥èµ„æº**: éªŒè¯EC2å®ä¾‹èµ„æºä½¿ç”¨
5. **æƒé™é—®é¢˜**: ç¡®è®¤æ–‡ä»¶å’Œç”¨æˆ·æƒé™

---

**æœ€åæ›´æ–°**: 2024-12-19  
**ç‰ˆæœ¬**: v2.0  
**ç»´æŠ¤è€…**: ITWORDSé¡¹ç›®ç»„ 